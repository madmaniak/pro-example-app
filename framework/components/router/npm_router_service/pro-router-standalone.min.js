window.R={init:function(o){if(o==null){o={}}this.root||(this.root=o.root||"main");this.views||(this.views=o.views||[this.root]);this.render||(this.render=o.render||window.render);this.h||(this.h=o.helpers||window._);window.onpopstate=this.url_changed;this.read()},cache:{},getters:{},setters:{},param:function(key){var base;if(this.getters[key]){return(base=this.cache)[key]||(base[key]=this.getters[key](decodeURI(this.params[key]||"")))}else{return decodeURI(this.params[key]||"")}},write:function(){if(arguments.length){if(arguments.length===1){this.h.each(arguments[0],function(v,k){R.params[k]=R.setters[k]?R.setters[k](v):v})}else{this.h.each(arguments,function(k,i){var v;if(!(i%2)){v=arguments[i+1];R.params[k]=R.setters[k]?R.setters[k](v):v}})}}window.history.replaceState({},window.location.pathname,this.to_path(this.view,this.params));this.url_changed()},toggle:function(flag,state){this.write(flag,state!=null?state?1:void 0:!this.params[flag]?1:void 0)},go:function(p){history.pushState({},null,p);this.url_changed()},read:function(){var ref;ref=this.split_path(document.location.pathname),this.view=ref[0],this.params=ref[1];this._safe_params()},split_path:function(p){var list,params,view;list=this.h.compact(p.split("/"));view=this._existance(list.length%2?list.shift():this.root);params=this.h.fromPairs(this.h.chunk(list,2));return[view,params]},_existance:function(v){if(this.h.includes(this.views,v)){return v}else{return"not_found"}},_safe_params:function(){return this.safe_params=this.h.fromPairs(this.h.reject(this.h.toPairs(this.params),function(p){return/^_/.test(p[0])}))},to_path:function(view,params){if(view==null){view=this.view}if(params==null){params=this.safe_params}return"/"+L(params).toPairs().reject(function(p){return!p[1]}).flatten().tap(function(_this){return function(a){if(view&&view!==_this.root){return a.unshift(view)}}}(this)).join("/")},url:function(v,o){var attributes;if(o){attributes=this.h.reduce(this.h.concat({},o),function(m,e){m[e.type]=e.id;return m})}return this.to_path(v,this.h.defaults(attributes||{},this.safe_params))},url_changed:function(){this.cache={};this.read();this.render()}};
