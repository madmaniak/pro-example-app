window.R={init:function(o){if(o==null){o={}}this.root||(this.root=o.root||"main");this.views||(this.views=o.views||[this.root]);this.render||(this.render=o.render||window.render);this.h||(this.h=o.helpers||window._);window.onpopstate=this.url_changed.bind(this);this.read()},cache:{},getters:{},setters:{},param:function(k){var base;if(this.getters[k]){return(base=this.cache)[k]||(base[k]=this.getters[k](decodeURI(this.params[k]||"")))}else{return decodeURI(this.params[k]||"")}},write:function(){var i,j,k,l,r,v;if(arguments.length){if(arguments.length===1){r=arguments[0];for(k in r){v=r[k];this._write(k,v)}}else{for(i=j=0,l=arguments.length;j<l;i=++j){k=arguments[i];if(!(i%2)){v=arguments[i+1];this._write(k,v)}}}}history.replaceState({},location.pathname,this.to_path(this.view,this.params));this.url_changed()},_write:function(k,v){this.params[k]=this.setters[k]?this.setters[k](v):v},toggle:function(f,s){this.write(f,s!=null?s?1:void 0:!this.params[f]?1:void 0)},go:function(p){history.pushState({},null,p);this.url_changed()},read:function(){var ref;ref=this.split_path(location.pathname),this.view=ref[0],this.params=ref[1];this._safe_params()},split_path:function(p){var list,params,view;list=this.h.compact(p.split("/"));view=this._existance(list.length%2?list.shift():this.root);params=this.h.fromPairs(this.h.chunk(list,2));return[view,params]},_existance:function(v){if(this.h.includes(this.views,v)){return v}else{return"not_found"}},_safe_params:function(){return this.safe_params=this.h.fromPairs(this.h.reject(this.h.toPairs(this.params),function(p){return/^_/.test(p[0])}))},to_path:function(v,p){var a;if(v==null){v=this.view}if(p==null){p=this.safe_params}a=this.h.flatten(this.h.reject(this.h.toPairs(p),function(p){return!p[1]}));if(v&&v!==this.root){a.unshift(v)}return"/"+a.join("/")},url:function(v,o){var attributes;if(o){attributes=this.h.reduce(this.h.concat({},o),function(m,e){m[e.type]=e.id;return m})}return this.to_path(v,this.h.defaults(attributes||{},this.safe_params))},url_changed:function(){this.cache={};this.read();this.render()}};
